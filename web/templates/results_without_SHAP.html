<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lead Scoring Results - AI Lead Scoring</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    {% include 'base.html' %}
    
    <div class="container">
        <div class="results-header">
            <h1>üìä Lead Scoring Results</h1>
        </div>

        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="stats-card">
                <div class="stats-label">Total Leads</div>
                <div class="stats-value">{{ stats.total_leads }}</div>
            </div>
            <div class="stats-card" style="border-left: 4px solid #10b981;">
                <div class="stats-label">High Priority</div>
                <div class="stats-value" style="color: #10b981;">{{ stats.high_priority }}</div>
            </div>
            <div class="stats-card" style="border-left: 4px solid #f59e0b;">
                <div class="stats-label">Medium Priority</div>
                <div class="stats-value" style="color: #f59e0b;">{{ stats.medium_priority }}</div>
            </div>
            <div class="stats-card" style="border-left: 4px solid #3b82f6;">
                <div class="stats-label">Avg Score</div>
                <div class="stats-value" style="color: #3b82f6;">{{ "%.0f"|format(stats.avg_score * 100) }}%</div>
            </div>
        </div>

        <!-- Download Button -->
        <div style="text-align: right; margin: 20px 0;">
            <a href="{{ url_for('download', filename=stats.filename) }}" class="btn btn-primary">
                ‚¨áÔ∏è Download Full Results
            </a>
        </div>

        <!-- Top Leads Table -->
        <div class="results-section">
            <h2>Top 50 Leads (Full Data)</h2>
            
            <div class="table-container">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th class="sticky-col">Rank</th>
                            {% if leads|length > 0 %}
                                {% for column in leads[0].keys() %}
                                    <th>{{ column }}</th>
                                {% endfor %}
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for lead in leads %}
                        <tr class="lead-row">
                            <td class="sticky-col rank-cell">
                                {{ loop.index }}
                            </td>
                            {% for column, value in lead.items() %}
                                <td>
                                    {% if column == 'conversion_probability' %}
                                        <span class="score-badge">
                                            {{ "%.1f"|format(value * 100) }}%
                                        </span>
                                    {% elif column == 'segment' %}
                                        {% if value == 'High' %}
                                            <span class="badge badge-high">üî• High</span>
                                        {% elif value == 'Medium' %}
                                            <span class="badge badge-medium">‚ö° Medium</span>
                                        {% else %}
                                            <span class="badge badge-low">üí§ Low</span>
                                        {% endif %}
                                    {% elif column == 'recommendation' %}
                                        <div class="recommendation-cell">
                                            <details>
                                                <summary>üìã View</summary>
                                                <div class="recommendation-box">
                                                    {{ value }}
                                                </div>
                                            </details>
                                        </div>
                                    {% elif column == 'Prospect ID' %}
                                        <span class="id-cell">{{ value[:12] }}...</span>
                                    {% else %}
                                        <span class="data-cell">{{ value if value is not none else 'N/A' }}</span>
                                    {% endif %}
                                </td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <div class="table-tip">
                <p>
                    üí° <strong>Tip:</strong> Scroll horizontally to see all {{ leads[0].keys()|length if leads|length > 0 else 0 }} columns. 
                    Download full results (all {{ stats.total_leads }} leads) using the button above.
                </p>
            </div>
        </div>

        <!-- Action Buttons -->
        <div style="text-align: center; margin-top: 40px; margin-bottom: 40px;">
            <a href="{{ url_for('upload') }}" class="btn btn-secondary">Upload Another File</a>
            <a href="{{ url_for('index') }}" class="btn btn-secondary">Back to Home</a>
        </div>
    </div>
</body>
</html>